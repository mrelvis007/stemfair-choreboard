<!DOCTYPE html>
<html lang="en">

<head>
    <!-- BASE META -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">

    <title>Chore Reward System</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<style>
    @import url(/stemfair-choreboard/css/dseg.css);

    :root {
        --balance-zero: #dc3545;
        --balance-positive: #28a745;
        --balance-color: var(--balance-zero);
        /* Default to red */
        --font-family-DSEG7-7SEGG-CHAN: 'DSEG7-7SEGG-CHAN', monospace;
        --font-family-DSEG7-7SEGG-CHAN-MINI: 'DSEG7-7SEGG-CHAN-MINI', monospace;
        --font-family-DSEG7-Classic: 'DSEG7-Classic', monospace;
        --font-family-DSEG7-Classic-MINI: 'DSEG7-Classic-MINI', monospace;
        --font-family-DSEG7-Modern: 'DSEG7-Modern', monospace;
        --font-family-DSEG7-Modern-MINI: 'DSEG7-Modern-MINI', monospace;
        --font-family-DSEG14-Classic: 'DSEG14-Classic', monospace;
        --font-family-DSEG14-Classic-MINI: 'DSEG14-Classic-MINI', monospace;
        --font-family-DSEG14-Modern: 'DSEG14-Modern', monospace;
        --font-family-DSEG14-Modern-MINI: 'DSEG14-Modern-MINI', monospace;
        --font-family-DSEGWeather: 'DSEGWeather', monospace;
    }

    html,
    body {
        height: 100%;
        margin: 0;
    }

    body {
        display: flex;
        flex-direction: column;
        overflow-y: auto;
    }

    .container {
        flex: 1;
        /* Ensures the container grows to fill available space */
    }

    #balance {
        font-size: 7.5rem;
        font-family: var(--font-family-DSEG7-Classic);
        font-weight: 600;
    }

    #balance-numeral {
        color: var(--balance-color);
    }

    #balance-text {
        font-size: 2rem;
    }
</style>

<body class="bg-dark text-white">

    <div class="sticky-top bg-dark py-5 shadow">
        <div class="row justify-content-center">
            <div class="col-auto">
                <h1 class="text-uppercase">Chore Reward System</h1>
            </div>
        </div>
    
        <div class="row justify-content-center my-4">
            <div class="col-6">
                <div class="row text-center">
                    <div id="balance" class="col-12">
                        <div id="balance-numeral">0</div>
                    </div>
                    <div class="col-12">
                        <div id="balance-text">Points</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mb-5 pb-5">

        <div class="row justify-content-center mt-5">
            <div class="col-6">
                <div class="row justify-content-between align-items-end">
                    <div class="col-auto">
                        <h2 class="mb-0">Chores</h2>
                    </div>
                    <div class="col-auto mb-1">
                        <label for="sortOrder" class="d-block text-right">Sort By:</label>
                        <select id="sortOrder" class="form-control w-auto text-left">
                            <option value="asc">Low to High</option>
                            <option value="desc">High to Low</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-6">
                <div id="chore-list" class="mt-3">
                    <button class="btn btn-success btn-lg btn-block chore-btn d-flex justify-content-between" data-points="5">
                        <span>Make Bed</span>
                        <span class="font-weight-bold">5 Points</span>
                    </button>
                    <button class="btn btn-success btn-lg btn-block chore-btn d-flex justify-content-between" data-points="5">
                        <span>Water Plants</span>
                        <span class="font-weight-bold">5 Points</span>
                    </button>
                    <button class="btn btn-success btn-lg btn-block chore-btn d-flex justify-content-between" data-points="5">
                        <span>Feed Pet</span>
                        <span class="font-weight-bold">5 Points</span>
                    </button>
                    <button class="btn btn-success btn-lg btn-block chore-btn d-flex justify-content-between" data-points="10">
                        <span>Take Out Trash</span>
                        <span class="font-weight-bold">10 Points</span>
                    </button>
                    <button class="btn btn-success btn-lg btn-block chore-btn d-flex justify-content-between" data-points="10">
                        <span>Wash Dishes</span>
                        <span class="font-weight-bold">10 Points</span>
                    </button>
                    <button class="btn btn-success btn-lg btn-block chore-btn d-flex justify-content-between" data-points="10">
                        <span>Vacuum (per room)</span>
                        <span class="font-weight-bold">10 Points</span>
                    </button>
                    <button class="btn btn-success btn-lg btn-block chore-btn d-flex justify-content-between" data-points="15">
                        <span>Do Laundry (per load)</span>
                        <span class="font-weight-bold">15 Points</span>
                    </button>
                    <button class="btn btn-success btn-lg btn-block chore-btn d-flex justify-content-between" data-points="20">
                        <span>Clean Your Room</span>
                        <span class="font-weight-bold">20 Points</span>
                    </button>
                    <button class="btn btn-success btn-lg btn-block chore-btn d-flex justify-content-between" data-points="20">
                        <span>Walk Pet</span>
                        <span class="font-weight-bold">20 Points</span>
                    </button>
                    <button class="btn btn-success btn-lg btn-block chore-btn d-flex justify-content-between" data-points="25">
                        <span>Do Homework (without being asked)</span>
                        <span class="font-weight-bold">25 Points</span>
                    </button>                    
                </div>
            </div>
        </div>

        <div class="row justify-content-center mt-2">
            <div class="col-6">
                <div class="row no-gutters">
                    <div class="col mr-1">
                        <input type="number" id="customPoints" class="form-control form-control-lg h-100" placeholder="Custom Amount" min="1">
                    </div>
                    <div class="col ml-1">
                        <button id="addCustomPoints" class="btn btn-success btn-lg btn-block chore-btn h-100">Add Points</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row justify-content-center mt-5">
            <div class="col-6">
                <div class="row">
                    <div class="col-auto">
                        <h2 class="m-0">Redeem Rewards</h2>
                    </div>
                </div>
            </div>
        </div>
        <div class="row justify-content-center">
            <div id="reward-list" class="col-6 mt-3">
                <button class="btn btn-warning btn-lg btn-block reward-btn d-flex justify-content-between" data-cost="10">
                    <span>Special Treat</span>
                    <span class="font-weight-bold">10 Points</span>
                </button>
                <button class="btn btn-warning btn-lg btn-block reward-btn d-flex justify-content-between" data-cost="15">
                    <span>15 Minutes Extra Screen Time</span>
                    <span class="font-weight-bold">15 Points</span>
                </button>
                <button class="btn btn-warning btn-lg btn-block reward-btn d-flex justify-content-between" data-cost="15">
                    <span>Game Night (pick the game)</span>
                    <span class="font-weight-bold">15 Points</span>
                </button>
                <button class="btn btn-warning btn-lg btn-block reward-btn d-flex justify-content-between" data-cost="20">
                    <span>Stay Up Late</span>
                    <span class="font-weight-bold">20 Points</span>
                </button>
                <button class="btn btn-warning btn-lg btn-block reward-btn d-flex justify-content-between" data-cost="20">
                    <span>One Hour of Free Time</span>
                    <span class="font-weight-bold">20 Points</span>
                </button>
                <button class="btn btn-warning btn-lg btn-block reward-btn d-flex justify-content-between" data-cost="25">
                    <span>Allowance Bonus ($5)</span>
                    <span class="font-weight-bold">25 Points</span>
                </button>
                <button class="btn btn-warning btn-lg btn-block reward-btn d-flex justify-content-between" data-cost="25">
                    <span>Choose Dinner</span>
                    <span class="font-weight-bold">25 Points</span>
                </button>
                <button class="btn btn-warning btn-lg btn-block reward-btn d-flex justify-content-between" data-cost="30">
                    <span>Skip a Chore</span>
                    <span class="font-weight-bold">30 Points</span>
                </button>
                <button class="btn btn-warning btn-lg btn-block reward-btn d-flex justify-content-between" data-cost="30">
                    <span>Movie Night (pick the movie)</span>
                    <span class="font-weight-bold">30 Points</span>
                </button>
                <button class="btn btn-warning btn-lg btn-block reward-btn d-flex justify-content-between" data-cost="50">
                    <span>Double Allowance Bonus</span>
                    <span class="font-weight-bold">50 Points</span>
                </button>
                <button class="btn btn-warning btn-lg btn-block reward-btn d-flex justify-content-between" data-cost="40">
                    <span>Pick a Fun Outing</span>
                    <span class="font-weight-bold">40 Points</span>
                </button>
                <button class="btn btn-warning btn-lg btn-block reward-btn d-flex justify-content-between" data-cost="50">
                    <span>Buy a Small Toy/Item</span>
                    <span class="font-weight-bold">50 Points</span>
                </button>                
            </div>
        </div>

        <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
            <div id="errorToast" class="toast align-items-center text-white bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                    <div class="toast-body">
                        Not enough points to redeem this reward!
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            </div>
        </div>

    </div>

    <script>
        let balance = 0;

        function updateBalance(points) {
            // Early exit if points are invalid (NaN or <= 0)
            if (isNaN(points) || points <= 0) {
                console.error("Invalid points value:", points);  // Log invalid points for debugging
                return;  // Exit early if points are invalid
            }

            balance += points;
            console.log("Updated balance:", balance);  // Debugging line to check the balance update

            $('#balance-numeral').text(balance);  // Update only the numeral part

            // Update the color based on balance
            if (balance === 0) {
                document.documentElement.style.setProperty('--balance-color', 'var(--balance-zero)');
            } else {
                document.documentElement.style.setProperty('--balance-color', 'var(--balance-positive)');
            }
        }

        function redeemReward(cost) {
            if (balance >= cost) {
                balance -= cost;
                $('#balance-numeral').text(balance);  // Update only the numeral part

                // Check balance and update the color
                if (balance === 0) {
                    document.documentElement.style.setProperty('--balance-color', 'var(--balance-zero)');
                } else {
                    document.documentElement.style.setProperty('--balance-color', 'var(--balance-positive)');
                }
            } else {
                alert("Not enough points to redeem this reward!");
            }
        }

        $(document).ready(function () {
            $(document).on('click', '.chore-btn', function () {
                let points = parseInt($(this).attr('data-points'));
                updateBalance(points);
            });

            $(document).on('click', '.reward-btn', function () {
                let cost = parseInt($(this).attr('data-cost'));
                redeemReward(cost);
            });

            $('#sortOrder').change(function () {
                let order = $(this).val();
                let chores = $('.chore-btn').toArray();

                chores.sort(function (a, b) {
                    let pointsA = parseInt($(a).attr('data-points'));
                    let pointsB = parseInt($(b).attr('data-points'));
                    return order === "asc" ? pointsA - pointsB : pointsB - pointsA;
                });

                $('#chore-list').empty().append(chores);
            });

            $('#addCustomPoints').click(function () {
                let customPoints = $('#customPoints').val().trim();  // Get the value from the input field and trim extra spaces
                console.log("Raw Custom Points input value:", customPoints);  // Log the raw input value

                // Check if the value is empty or not a valid number
                if (customPoints === "" || isNaN(customPoints)) {
                    alert("Please enter a valid positive number.");
                    return;  // Prevent further processing if input is invalid
                }

                customPoints = parseInt(customPoints);  // Convert to integer
                console.log("Parsed customPoints:", customPoints);  // Debugging line to check parsed value

                // Ensure custom points is a positive number before updating balance
                if (customPoints > 0) {
                    updateBalance(customPoints);  // Update the balance with the valid custom points
                    $('#customPoints').val('');    // Clear the input field after adding points
                } else {
                    alert("Please enter a positive number greater than 0.");
                }
            });

        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>